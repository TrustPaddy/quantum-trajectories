<!doctype html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Particles</title>
  <script src="aframe-v1.5.0.min.js"></script>
  <style>
    /* â”€â”€â”€ Theme variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root{
      color-scheme: dark;
      --bg: #0b0f17;
      --panel: #121826;
      --card: #0f1522;
      --acc: #7dd3fc;
      --txt: #e5e7eb;
      --muted:#94a3b8;
      --ok:  #22c55e;
      --warn:#f59e0b;
      --err: #ef4444;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --range-track: rgba(255,255,255,.15);
    }
    :root[data-theme="light"]{
      color-scheme: light;
      --bg: #f5f5f7;
      --panel: #ffffff;
      --card: #f3f4f6;
      --acc: #0ea5e9;
      --txt: #111827;
      --muted:#6b7280;
      --ok:  #16a34a;
      --warn:#d97706;
      --err: #b91c1c;
      --shadow: 0 10px 26px rgba(15,23,42,.18);
      --range-track: rgba(148,163,184,.6);
    }

    /* â”€â”€â”€ Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);
      font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}

    /* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app{display:grid;grid-template-rows:auto 1fr;min-height:100vh}

    .topbar{
      position:sticky;top:0;z-index:5;
      display:flex;align-items:center;gap:.75rem;
      padding:.6rem .9rem;
      background:var(--panel);
      backdrop-filter:saturate(1.2) blur(8px);
      border-bottom:1px solid rgba(148,163,184,.3);
      flex-wrap:wrap;
    }
    .title{font-weight:700;letter-spacing:.2px}
    .spacer{flex:1}
    .group{display:inline-flex;align-items:center;gap:.5rem}
    .section{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.3rem .6rem;border-radius:10px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
    }
    .section-label{
      font-size:.8rem;opacity:.7;font-weight:600;
      margin-right:.2rem;
    }

    .wrap{display:grid;grid-template-columns:minmax(260px,320px) 1fr;gap:14px;padding:14px}
    .panel{
      background:var(--panel);border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);padding:10px;box-shadow:var(--shadow);
      height:calc(100vh - 90px);overflow:auto;position:relative;z-index:3;
    }
    .scene{
      position:relative;z-index:1;overflow:hidden;
      background:radial-gradient(1200px 600px at 50% 10%,rgba(125,211,252,.08),transparent 60%),
                 linear-gradient(180deg,#0b0f17,#05070c);
      border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);
    }
    @media(max-width:1000px){.wrap{grid-template-columns:1fr}.panel{order:2}.scene{order:1}}

    /* â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn{
      appearance:none;border:1px solid rgba(255,255,255,.12);
      background:var(--card);color:var(--txt);
      padding:.45rem .7rem;border-radius:10px;cursor:pointer;
      transition:.2s;display:inline-flex;align-items:center;gap:.5rem;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow)}
    .btn.primary{background:linear-gradient(180deg,#1f2937,#111827);border-color:#1f2a38}
    :root[data-theme="light"] .btn.primary{
      background:#f9fafb;border-color:rgba(148,163,184,.7);
      color:#111827;box-shadow:0 3px 8px rgba(15,23,42,.12);
    }
    :root[data-theme="light"] .btn.primary:hover{background:#fff}
    .btn.ghost{background:transparent}
    .btn.warn{border-color:rgba(245,158,11,.4)}
    .btn.ok{border-color:rgba(34,197,94,.4)}
    .btn.toggle[aria-pressed="true"],.btn.toggle.active{
      border-color:rgba(125,211,252,.7);box-shadow:var(--shadow)
    }
    .btn.recording{
      background:linear-gradient(135deg,rgba(34,197,94,.15),rgba(34,197,94,.25));
      border-color:rgba(34,197,94,.4);
      color:#22c55e;
      box-shadow:0 0 20px rgba(34,197,94,.3),0 0 40px rgba(34,197,94,.15),inset 0 0 15px rgba(34,197,94,.1);
      animation:pulse-glow 2s ease-in-out infinite;
    }
    @keyframes pulse-glow{
      0%,100%{box-shadow:0 0 20px rgba(34,197,94,.3),0 0 40px rgba(34,197,94,.15),inset 0 0 15px rgba(34,197,94,.1)}
      50%{box-shadow:0 0 25px rgba(34,197,94,.4),0 0 50px rgba(34,197,94,.2),inset 0 0 20px rgba(34,197,94,.15)}
    }

    /* â”€â”€â”€ Range slider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .range{appearance:none;width:160px;height:6px;border-radius:999px;background:var(--range-track);outline:none}
    .range::-webkit-slider-thumb{appearance:none;width:16px;height:16px;border-radius:50%;background:var(--acc);border:0;box-shadow:0 2px 6px rgba(0,0,0,.4)}
    .range::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:var(--acc);border:0;box-shadow:0 2px 6px rgba(0,0,0,.4)}

    /* â”€â”€â”€ Select â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .select{background:var(--card);border:1px solid rgba(255,255,255,.12);color:var(--txt);padding:.45rem .6rem;border-radius:10px}

    /* â”€â”€â”€ HUD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hud{position:absolute;left:10px;right:10px;bottom:10px;display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:.35rem .55rem;font-size:.9rem;color:var(--muted)}
    .chip strong{color:var(--txt);font-weight:700}
    .chip.ctr{display:inline-flex;align-items:center;gap:.4rem}
    .chip .mini{
      appearance:none;border:1px solid rgba(255,255,255,.18);
      background:transparent;color:var(--txt);
      padding:.05rem .45rem;border-radius:8px;line-height:1;cursor:pointer;
    }
    .chip .mini:hover{border-color:rgba(125,211,252,.55)}

    /* â”€â”€â”€ Readout grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .readout{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-top:6px}

    /* â”€â”€â”€ Hidden fields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hidden-field{display:inline-flex;gap:6px;align-items:center}
    .hidden-field input{width:70px;background:transparent;border:1px solid rgba(255,255,255,.12);
      border-radius:8px;color:var(--txt);padding:.2rem .35rem}

    /* â”€â”€â”€ A-Frame fit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    a-scene{height:calc(100vh - 90px);border-radius:var(--radius);position:relative!important;width:100%!important}
    .a-canvas,a-scene canvas{position:absolute;inset:0;width:100%!important;height:100%!important}

    /* â”€â”€â”€ Quantum state label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .quantum-label{
      font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
      font-size:.85rem;color:var(--acc);margin-top:8px;padding:6px 8px;
      background:rgba(125,211,252,.06);border:1px solid rgba(125,211,252,.15);
      border-radius:8px;text-align:center;
    }

    /* â”€â”€â”€ Section dividers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-divider{
      margin:16px 0 8px;padding-bottom:4px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .section-title{
      font-size:.85rem;font-weight:700;color:var(--acc);
      text-transform:uppercase;letter-spacing:.5px;
    }

    /* â”€â”€â”€ Help Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .help-panel{
      border:1px solid rgba(255,255,255,.08);border-radius:10px;
      background:var(--card);margin-bottom:12px;
    }
    .help-panel summary{
      padding:.6rem .75rem;cursor:pointer;font-weight:600;
      list-style:none;user-select:none;border-radius:10px;
      transition:.2s;display:flex;align-items:center;gap:.5rem;
    }
    .help-panel summary::-webkit-details-marker{display:none}
    .help-panel summary::before{
      content:'â–¸';font-size:.9em;transition:transform .2s;
      display:inline-block;
    }
    .help-panel[open] summary::before{transform:rotate(90deg)}
    .help-panel summary:hover{background:rgba(255,255,255,.04)}
    .help-content{
      padding:0 .75rem .75rem;font-size:.9rem;line-height:1.5;
      color:var(--muted);
    }
    .help-content h4{
      color:var(--txt);margin:.75rem 0 .35rem;font-size:.95rem;
      font-weight:600;
    }
    .help-content ul{margin:.3rem 0;padding-left:1.2rem}
    .help-content li{margin:.2rem 0}
    .help-content strong{color:var(--txt);font-weight:600}
    .help-content code{
      background:rgba(125,211,252,.1);padding:.1rem .35rem;
      border-radius:4px;font-size:.85em;color:var(--acc);
    }

    /* â”€â”€â”€ Toast Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast-container{
      position:fixed;top:80px;left:50%;transform:translateX(-50%);
      z-index:999;display:flex;flex-direction:column;gap:8px;
      pointer-events:none;max-width:500px;width:90%;
    }
    .toast{
      background:var(--panel);border:1px solid rgba(255,255,255,.12);
      border-radius:10px;padding:.65rem .9rem;box-shadow:var(--shadow);
      display:flex;align-items:center;gap:.6rem;
      animation:slideIn .3s ease-out;pointer-events:auto;
    }
    .toast.error{border-color:rgba(239,68,68,.5);background:rgba(239,68,68,.08)}
    .toast.warning{border-color:rgba(245,158,11,.5);background:rgba(245,158,11,.08)}
    .toast.success{border-color:rgba(34,197,94,.5);background:rgba(34,197,94,.08)}
    .toast.info{border-color:rgba(125,211,252,.5);background:rgba(125,211,252,.08)}
    .toast-icon{font-size:1.2em;flex-shrink:0}
    .toast-message{flex:1;font-size:.9rem}
    @keyframes slideIn{
      from{opacity:0;transform:translateY(-20px)}
      to{opacity:1;transform:translateY(0)}
    }

    /* â”€â”€â”€ Cursor states for drag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    a-scene{cursor:default}
    a-scene.hovering-particle{cursor:grab}
    a-scene.dragging-particle{cursor:grabbing!important}
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div id="toast-container"></div>

  <div class="app">

    <!-- â•â•â• Topbar â•â•â• -->
    <div class="topbar">
      <span class="title">âš›ï¸ Simulation</span>

      <!-- Simulation Controls -->
      <div class="section">
        <button id="myButton" class="btn primary" title="Start / Stop">Start</button>
        <button id="PathButton" class="btn" title="Record Path">â–¶</button>
        <button id="btnDeletePath" class="btn" title="Clear Path">Clear Path</button>
        <button id="btnResetV" class="btn" title="Reset Velocities to Zero">v = 0</button>
      </div>

      <!-- Physics Modes -->
      <div class="section">
        <span class="section-label">Physics:</span>
        <button id="btnAnsatz"   class="btn toggle" aria-pressed="false" title="Angular Momentum Ansatz">Ang. Mom.</button>
        <button id="btnLarmor"   class="btn toggle" aria-pressed="false" title="Larmor Radiation">Larmor</button>
        <button id="btnThetaPhi" class="btn toggle" aria-pressed="false" title="Î¸/Ï† Quantum Terms">Î¸/Ï†</button>
        <button id="btnLock"     class="btn toggle" aria-pressed="false" title="Nucleus Lock">Lock</button>
        <button id="btnRelax"    class="btn toggle" aria-pressed="false" title="Automatic Relaxation">Relax</button>
      </div>

      <div class="spacer"></div>

      <!-- Settings -->
      <div class="section">
        <span class="section-label">Settings:</span>
        <label for="dtSlider" style="opacity:.85">Î”t</label>
        <input id="dtSlider" class="range" type="range" min="5" max="200" step="1" value="33" />
        <span id="dtValue" class="chip" style="padding:.2rem .45rem">33 ms</span>

        <label style="margin-left:.5rem">Model
          <select id="modelSelect" class="select">
            <option value="HAtom">H Atom</option>
            <option value="H2Cation">Hâ‚‚âº</option>
            <option value="HAnion">Hâ»</option>
            <option value="HECation">Heâº</option>
            <option value="HEAtom">He</option>
          </select>
        </label>
        <button id="themeToggle" class="btn ghost" title="Toggle Light/Dark Theme">â˜¾</button>
      </div>
    </div>

    <!-- â•â•â• Main content â•â•â• -->
    <div class="wrap">

      <!-- â”€â”€â”€ Control Panel â”€â”€â”€ -->
      <aside class="panel">

        <!-- Help Panel -->
        <details class="help-panel">
          <summary>â„¹ï¸ Help & Controls</summary>
          <div class="help-content">
            <h4>Getting Started</h4>
            <ul>
              <li><strong>Start/Stop:</strong> Click the Start button to begin the simulation</li>
              <li><strong>Drag Particles:</strong> Click and drag any particle to reposition it in 3D space</li>
              <li><strong>Record Paths:</strong> Click â–¶ to record electron trajectories (button glows green)</li>
            </ul>

            <h4>Physics Modes</h4>
            <ul>
              <li><strong>Ang. Mom.:</strong> Enables angular momentum term in force calculation</li>
              <li><strong>Larmor:</strong> Applies radiation damping (exponential velocity decay)</li>
              <li><strong>Î¸/Ï†:</strong> Adds quantum angular correction terms from wavefunction</li>
              <li><strong>Lock:</strong> Freezes nucleus in place (protons don't move)</li>
              <li><strong>Relax:</strong> Automatic energy level transitions (electrons decay to lower states)</li>
            </ul>

            <h4>Quantum Numbers</h4>
            <ul>
              <li><strong>n:</strong> Principal quantum number (energy level, n â‰¥ 1)</li>
              <li><strong>â„“:</strong> Orbital angular momentum (0 â‰¤ â„“ < n)</li>
              <li><strong>m:</strong> Magnetic quantum number (-â„“ â‰¤ m â‰¤ â„“)</li>
              <li><strong>Selection rules:</strong> Î”â„“ = Â±1, Î”m â‰¤ Â±1 for transitions</li>
            </ul>

            <h4>Controls</h4>
            <ul>
              <li><strong>eâ»/pâº:</strong> Add/remove electrons or protons</li>
              <li><strong>x/y/z inputs:</strong> Manually set particle position in picometers</li>
              <li><strong>Î”t slider:</strong> Adjust simulation timestep (smaller = more accurate but slower)</li>
              <li><strong>Model:</strong> Switch between different atomic systems (H, Hâ‚‚âº, He, etc.)</li>
            </ul>
          </div>
        </details>

        <!-- â•â•â• QUANTUM STATE â•â•â• -->
        <div class="section-divider">
          <span class="section-title">Quantum State</span>
        </div>

        <div class="quantum-label" id="quantumStateLabel">|1, 0, 0âŸ©</div>

        <!-- Distance & Energy -->
        <div class="readout" style="margin-top:10px">
          <div class="chip">Distance: <strong id="Distance">â€“</strong></div>
          <div class="chip">Energy: <strong id="Energy">â€“</strong></div>
        </div>

        <!-- Quantum numbers: n, â„“, m -->
        <div class="readout">
          <div class="chip ctr">
            n:
            <button id="nDown" class="mini">âˆ’</button>
            <strong id="nLvl">1</strong>
            <button id="nUp" class="mini">+</button>
          </div>
          <div class="chip ctr">
            â„“:
            <button id="lDown" class="mini">âˆ’</button>
            <strong id="lLvl">0</strong>
            <button id="lUp" class="mini">+</button>
          </div>
          <div class="chip ctr">
            m:
            <button id="mDown" class="mini">âˆ’</button>
            <strong id="mLvl">0</strong>
            <button id="mUp" class="mini">+</button>
          </div>
        </div>

        <!-- â•â•â• SYSTEM PROPERTIES â•â•â• -->
        <div class="section-divider">
          <span class="section-title">System Properties</span>
        </div>

        <!-- Particle counts -->
        <div class="readout">
          <div class="chip ctr">
            eâ»:
            <button id="eDown" class="mini">âˆ’</button>
            <strong id="DispCountElectron">1</strong>
            <button id="eUp" class="mini">+</button>
          </div>
          <div class="chip ctr">
            pâº:
            <button id="pDown" class="mini">âˆ’</button>
            <strong id="DispCountProton">1</strong>
            <button id="pUp" class="mini">+</button>
          </div>
        </div>

        <!-- â•â•â• SELECTED PARTICLE â•â•â• -->
        <div class="section-divider">
          <span class="section-title">Selected Particle</span>
        </div>

        <!-- Manual position input -->
        <div class="readout">
          <div class="hidden-field">x <input id="Xs" type="text" placeholder="x (pm)"></div>
          <div class="hidden-field">y <input id="Ys" type="text" placeholder="y (pm)"></div>
          <div class="hidden-field">z <input id="Zs" type="text" placeholder="z (pm)"></div>
        </div>

        <!-- â•â•â• DEBUG INFO â•â•â• -->
        <details class="help-panel" style="margin-top:12px">
          <summary>ğŸ”¬ Advanced / Debug Info</summary>
          <div class="help-content">

            <!-- Force vectors -->
            <h4>Force (first electron)</h4>
            <div class="readout">
              <div class="chip">F<sub>x</sub>: <strong id="fx">0</strong></div>
              <div class="chip">F<sub>y</sub>: <strong id="fy">0</strong></div>
              <div class="chip">F<sub>z</sub>: <strong id="fz">0</strong></div>
            </div>

            <!-- All electron positions -->
            <h4>All Electron Positions</h4>
            <div class="readout">
              <div class="chip">eâ‚ x: <strong id="x1">â€“</strong></div>
              <div class="chip">eâ‚ y: <strong id="y1">â€“</strong></div>
              <div class="chip">eâ‚ z: <strong id="z1">â€“</strong></div>
              <div class="chip">eâ‚‚ x: <strong id="x2">â€“</strong></div>
              <div class="chip">eâ‚‚ y: <strong id="y2">â€“</strong></div>
              <div class="chip">eâ‚‚ z: <strong id="z2">â€“</strong></div>
            </div>

            <!-- Velocity -->
            <h4>Velocity (selected particle)</h4>
            <div class="readout">
              <div class="chip">v<sub>x</sub>: <strong id="vx">0</strong></div>
              <div class="chip">v<sub>y</sub>: <strong id="vy">0</strong></div>
              <div class="chip">v<sub>z</sub>: <strong id="vz">0</strong></div>
              <div class="chip">|v|: <strong id="vMag">0</strong></div>
            </div>

          </div>
        </details>

      </aside>

      <!-- â”€â”€â”€ 3D Scene â”€â”€â”€ -->
      <main class="scene">
        <a-scene embedded background="color: #111"
                 renderer="colorManagement: true; physicallyCorrectLights: true">
          <a-entity id="camera" position="0 0 200" camera look-controls></a-entity>
          <a-entity id="mouseCursor" cursor="rayOrigin: mouse"
                    raycaster="objects: .clickable; far: 1000; interval: 50"></a-entity>
          <a-entity light="type: ambient; color: #fff; intensity: 0.6"></a-entity>
          <a-entity light="type: directional; color: #fff; intensity: 0.8" position="0 1 1"></a-entity>
        </a-scene>

        <div class="hud">
          <div class="chip">FPS: <strong id="fpsRead">--</strong></div>
          <div class="chip">Î”t: <strong id="dtRead">33 ms</strong></div>
          <div class="chip">Ang. Mom.: <strong id="ansatzRead">off</strong></div>
          <div class="chip">Larmor: <strong id="larmorRead">off</strong></div>
          <div class="chip">Lock: <strong id="lockRead">off</strong></div>
          <div class="chip">Î¸/Ï†: <strong id="thetaPhiRead">off</strong></div>
          <div class="chip">Relax: <strong id="relaxRead">off</strong></div>
        </div>
      </main>
    </div>
  </div>

  <!-- â•â•â• App scripts â•â•â• -->
  <script src="./fps.js"></script>
  <script src="./dynamics.js"></script>

  <!-- â•â•â• UI Wiring â•â•â• -->
  <script>
    (function(){
      // â”€â”€ Toast Notification System â”€â”€
      window.showToast = function(message, type = 'info') {
        const container = document.getElementById('toast-container');
        if (!container) return;

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const icons = {
          error: 'âŒ',
          warning: 'âš ï¸',
          success: 'âœ…',
          info: 'â„¹ï¸'
        };

        toast.innerHTML = `
          <span class="toast-icon">${icons[type] || icons.info}</span>
          <span class="toast-message">${message}</span>
        `;

        container.appendChild(toast);

        // Auto-dismiss after 3 seconds
        setTimeout(() => {
          toast.style.animation = 'slideIn .3s ease-out reverse';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      };

      // â”€â”€ Fallback guards â”€â”€
      const API = [
        'startAnimation','startRecord','deletePath','setVelocitiesToZero',
        'changeAtomModel','changeInterval',
        'incrementEnergyLevel','decrementEnergyLevel',
        'incrementAngularMomentum','decrementAngularMomentum',
        'incrementM','decrementM',
        'changeAnsatz','toggleLamor','toggleThetaPhi',
        'lockNucleus','changeCountElectron','changeCountProton',
        'toggleRelaxation',
      ];
      API.forEach(name => {
        if (typeof window[name] !== 'function')
          window[name] = () => console.warn(name + "(): dynamics.js not loaded?");
      });

      // â”€â”€ Helper: wire a click â”€â”€
      function on(id, fn) {
        const el = document.getElementById(id);
        if (el) el.addEventListener('click', fn);
      }

      // â”€â”€ Helper: toggle button with aria-pressed â”€â”€
      function bindToggle(id, onToggle) {
        const btn = document.getElementById(id);
        if (!btn) return;
        btn.addEventListener('click', () => {
          const next = btn.getAttribute('aria-pressed') !== 'true';
          btn.setAttribute('aria-pressed', String(next));
          btn.classList.toggle('active', next);
          onToggle(next);
        });
      }

      // â”€â”€ Topbar buttons â”€â”€
      on('myButton',      () => window.startAnimation());
      on('PathButton',    () => window.startRecord());
      on('btnDeletePath', () => window.deletePath());
      on('btnResetV',     () => window.setVelocitiesToZero());

      document.getElementById('modelSelect')
        .addEventListener('change', e => window.changeAtomModel(e.target.value));

      // â”€â”€ Quantum numbers: n, â„“, m â”€â”€
      on('nUp',   () => window.incrementEnergyLevel());
      on('nDown', () => window.decrementEnergyLevel());
      on('lUp',   () => window.incrementAngularMomentum());
      on('lDown', () => window.decrementAngularMomentum());
      on('mUp',   () => window.incrementM());
      on('mDown', () => window.decrementM());

      // â”€â”€ Particle counts â”€â”€
      on('eUp',   () => window.changeCountElectron(+1));
      on('eDown', () => window.changeCountElectron(-1));
      on('pUp',   () => window.changeCountProton(+1));
      on('pDown', () => window.changeCountProton(-1));

      // â”€â”€ Toggle buttons â”€â”€
      bindToggle('btnAnsatz', next => {
        window.changeAnsatz();
        document.getElementById('ansatzRead').textContent = next ? 'on' : 'off';
      });
      bindToggle('btnLarmor', next => {
        window.toggleLamor(next);
        document.getElementById('larmorRead').textContent = next ? 'on' : 'off';
      });
      bindToggle('btnThetaPhi', next => {
        window.toggleThetaPhi(next);
        document.getElementById('thetaPhiRead').textContent = next ? 'on' : 'off';
      });
      bindToggle('btnLock', next => {
        window.lockNucleus();
        document.getElementById('lockRead').textContent = next ? 'on' : 'off';
      });
      bindToggle('btnRelax', next => {
        window.toggleRelaxation(next);
        document.getElementById('relaxRead').textContent = next ? 'on' : 'off';
      });

      // â”€â”€ Î”t slider â”€â”€
      const dtSlider = document.getElementById('dtSlider');
      const dtValue  = document.getElementById('dtValue');
      function applyDt(val) {
        val = parseInt(val, 10);
        if (!Number.isFinite(val)) return;
        window.changeInterval(val);
        document.getElementById('dtRead').textContent = val + ' ms';
        dtValue.textContent = val + ' ms';
      }
      if (dtSlider) {
        dtSlider.addEventListener('input',  e => applyDt(e.target.value));
        dtSlider.addEventListener('change', e => applyDt(e.target.value));
      }

      // â”€â”€ Theme toggle â”€â”€
      const root = document.documentElement;
      const themeToggle = document.getElementById('themeToggle');

      function setTheme(theme) {
        root.setAttribute('data-theme', theme);
        if (themeToggle) themeToggle.textContent = theme === 'dark' ? 'â˜¾' : 'â˜€ï¸';
        try { localStorage.setItem('ui-theme', theme); } catch {}
      }

      let saved = null;
      try { saved = localStorage.getItem('ui-theme'); } catch {}
      setTheme(saved === 'light' ? 'light' : 'dark');

      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          setTheme(root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        });
      }

      // â”€â”€ Quantum state label updater â”€â”€
      // Polls STATE.N / L / M every 500ms to update the |n,â„“,mâŸ© display
      const qLabel = document.getElementById('quantumStateLabel');
      if (qLabel) {
        setInterval(() => {
          const n = document.getElementById('nLvl')?.textContent || '?';
          const l = document.getElementById('lLvl')?.textContent || '?';
          const m = document.getElementById('mLvl')?.textContent || '?';
          qLabel.textContent = `|${n}, ${l}, ${m}âŸ©`;
        }, 500);
      }

      // â”€â”€ Self-tests (dev console) â”€â”€
      (function tests(){
        function test(name, fn) {
          try { fn(); console.log('âœ… ' + name); }
          catch(e) { console.error('âŒ ' + name + ' â†’', e); }
        }
        test('A-Frame scene embedded',    () => { if (!document.querySelector('a-scene[embedded]')) throw 'missing'; });
        test('Core API functions present', () => {
          ['startAnimation','startRecord','deletePath','setVelocitiesToZero',
           'changeInterval','changeAnsatz','toggleLamor','lockNucleus',
           'tryTransition','toggleRelaxation','incrementM','decrementM']
            .forEach(fn => { if (typeof window[fn] !== 'function') throw fn + ' missing'; });
        });
        test('Topbar slider present',     () => { if (!document.getElementById('dtSlider')) throw 'missing'; });
        test('Quantum m controls present', () => { if (!document.getElementById('mUp')) throw 'missing'; });
      })();
    })();
  </script>
</body>
</html>